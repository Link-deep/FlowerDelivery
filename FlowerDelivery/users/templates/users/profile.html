{% extends 'main/layout.html' %}


{% block title %}
    <title>–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —Ç–æ–≤–∞—Ä–æ–≤ —Å –∏–≥—Ä–∞–º–∏ –Ω–∞ Nintendo Switch. –ü—Ä–æ—Ñ–∏–ª—å.</title>

<style>

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–æ—Ñ–∏–ª—è */
.profile-container {
    max-width: 600px;
    margin: 50px auto;
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.input-container {
    display: flex;
    align-items: center; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –≤—Å—ë –ø–æ –æ–¥–Ω–æ–π –ª–∏–Ω–∏–∏ */
    gap: 10px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –ø–æ–ª–µ–º –∏ –∏–∫–æ–Ω–∫–∞–º–∏ */
    flex: 1;
}

/* –î–≤—É—Ö–∫–æ–ª–æ–Ω–æ—á–Ω—ã–π –º–∞–∫–µ—Ç */
.profile-content {
    display: flex;
    align-items: center;
    gap: 20px;
}

/* –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ (–∞–≤–∞—Ç–∞—Ä) */
.profile-avatar-section {
    flex: 0 0 150px;
    text-align: center;
}

.profile-avatar {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #007bff;
    cursor: pointer;
}

.hidden-input {
    display: none;
}

/* –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è) */
.profile-info {
    flex: 1;
}

.profile-info p {
    font-size: 16px;
    color: #555;
    margin: 5px 0;
}

/* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
.profile-input {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 16px;
    transition: 0.3s;
}

.profile-input:focus {
    border-color: #007bff;
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
}

/* –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ */
.logout-btn {
    display: block;
    text-decoration: none;
    margin-top: 20px;
    padding: 10px;
    border-radius: 5px;
    font-weight: bold;
    text-align: center;
    background: red;
    color: white;
    transition: 0.3s;
}

.logout-btn:hover {
    opacity: 0.8;
}


</style>

{% endblock %}


{% block content %}
    <div class="profile-container">
        <h2>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>

        <div class="profile-content">
            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ê–≤–∞—Ç–∞—Ä -->
            <div class="profile-avatar-section">
                {% if user.avatar %}
                <img src="{{ user.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" class="profile-avatar">
            {% else %}
                <img src="/media/avatar/default-avatar.png" alt="–ê–≤–∞—Ç–∞—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" class="profile-avatar">
            {% endif %}
                <button class="edit-btn" onclick="document.getElementById('avatar-input').click()">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                <input type="file" id="avatar-input" class="hidden-input" accept="image/*" onchange="saveAvatar()">
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div class="profile-info">
                <p><strong>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</strong> {{ user.username }}</p>
                <p><strong>Email:</strong> {{ user.email }}</p>

                <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
                <div class="profile-field">
                    <label><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong></label>
                    <div class="input-container">
                    <input type="text" id="phone" value="{{ user.phone_number }}" class="profile-input" disabled>
                    <button class="icon-btn edit-icon" onclick="enableEdit('phone')">üñâ</button>
                    <button class="icon-btn save-icon hidden" onclick="saveProfile('phone')">‚úîÔ∏è</button>
                    </div>
                </div>

                <!-- –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è -->
                <div class="profile-field">
                    <label><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong></label>
                    <div class="input-container">
                    <input type="date" id="birth_date" value="{{ user.birth_date|date:'Y-m-d' }}" class="profile-input" disabled>
                    <button class="icon-btn edit-icon" onclick="enableEdit('birth_date')">üñâ</button>
                    <button class="icon-btn save-icon hidden" onclick="saveProfile('birth_date')">‚úîÔ∏è</button>
                    </div>
                </div>

                <!-- –ê–¥—Ä–µ—Å -->
                <div class="profile-field">
                    <label><strong>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</strong></label>
                    <div class="input-container">
                    <textarea id="address" class="profile-input" disabled>{{ user.address }}</textarea>
                    <button class="icon-btn edit-icon" onclick="enableEdit('address')">üñâ</button>
                    <button class="icon-btn save-icon hidden" onclick="saveProfile('address')">‚úîÔ∏è</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function enableEdit(field) {
            let input = document.getElementById(field);
            let editIcon = input.nextElementSibling;
            let saveIcon = editIcon.nextElementSibling;

            input.removeAttribute("disabled"); // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª–µ
            input.focus(); // –î–µ–ª–∞–µ–º —Ñ–æ–∫—É—Å
            editIcon.classList.add("hidden"); // –°–∫—Ä—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            saveIcon.classList.remove("hidden"); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        function saveProfile(field) {
            let input = document.getElementById(field);
            let saveIcon = input.nextElementSibling.nextElementSibling;

            let formData = new FormData();
            formData.append("csrfmiddlewaretoken", "{{ csrf_token }}");
            formData.append(field, input.value);

            fetch("{% url 'edit_profile' %}", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    console.log(field + " —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!");
                    input.setAttribute("disabled", "true"); // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª–µ
                    saveIcon.classList.add("hidden"); // –°–∫—Ä—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                    input.previousElementSibling.classList.remove("hidden"); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                } else {
                    alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏.");
                }
            });
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞
        function saveAvatar() {
            let formData = new FormData();
            formData.append("csrfmiddlewaretoken", "{{ csrf_token }}");
            formData.append("avatar", document.getElementById("avatar-input").files[0]);

            fetch("{% url 'edit_profile' %}", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    document.getElementById("avatar-preview").src = URL.createObjectURL(document.getElementById("avatar-input").files[0]);
                } else {
                    alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤–∞—Ç–∞—Ä–∞.");
                }
            });
        }
    </script>
{% endblock %}


